{# Sistema de mensajes premium tipo toast/barra superior #}
{% if messages %}
<div class="messages-container" id="messages-container">
  {% for message in messages %}
    {% if message.tags == 'error' or message.tags == 'danger' %}
    <div class="message-toast message-error" data-auto-dismiss="true">
      <div class="message-header">
        <div class="message-content">
          <i class="fas fa-exclamation-triangle message-icon" style="color: #fde047;"></i>
          <span class="message-text">{{ message }}</span>
        </div>
        <button class="message-close" onclick="dismissMessage(this)">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="message-progress"></div>
    </div>
    {% elif message.tags == 'warning' %}
    <div class="message-toast message-warning" data-auto-dismiss="true">
      <div class="message-header">
        <div class="message-content">
          <i class="fas fa-exclamation-circle message-icon" style="color: #fde047;"></i>
          <span class="message-text">{{ message }}</span>
        </div>
        <button class="message-close" onclick="dismissMessage(this)">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="message-progress"></div>
    </div>
    {% elif message.tags == 'success' %}
    <div class="message-toast message-success" data-auto-dismiss="true">
      <div class="message-header">
        <div class="message-content">
          <i class="fas fa-check-circle message-icon" style="color: #d1fae5;"></i>
          <span class="message-text">{{ message }}</span>
        </div>
        <button class="message-close" onclick="dismissMessage(this)">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="message-progress"></div>
    </div>
    {% else %}
    <div class="message-toast message-info" data-auto-dismiss="true">
      <div class="message-header">
        <div class="message-content">
          <i class="fas fa-info-circle message-icon" style="color: #e0f2fe;"></i>
          <span class="message-text">{{ message }}</span>
        </div>
        <button class="message-close" onclick="dismissMessage(this)">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="message-progress"></div>
    </div>
    {% endif %}
  {% endfor %}
</div>

<script>
// Sistema de auto-dismiss para mensajes premium
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.message-toast[data-auto-dismiss="true"]');
    
    messages.forEach(function(message, index) {
        // Auto-dismiss después de 5 segundos (con delay progresivo para múltiples mensajes)
        setTimeout(function() {
            if (message && message.parentNode) {
                dismissMessage(message.querySelector('.message-close'));
            }
        }, 5000 + (index * 500)); // 500ms de delay adicional por cada mensaje
    });
});

function dismissMessage(button) {
    const message = button.closest('.message-toast');
    if (message) {
        message.classList.add('dismissing');
        setTimeout(function() {
            message.remove();
            
            // Si no quedan mensajes, ocultar el contenedor
            const container = document.getElementById('messages-container');
            if (container && container.children.length === 0) {
                container.remove();
            }
        }, 300);
    }
}

// Función para crear mensajes dinámicos desde JavaScript
function showMessage(text, type = 'info') {
    let container = document.getElementById('messages-container');
    
    // Crear contenedor si no existe
    if (!container) {
        container = document.createElement('div');
        container.className = 'messages-container';
        container.id = 'messages-container';
        document.body.appendChild(container);
    }
    
    // Mapear tipos de mensaje
    const messageTypes = {
        'error': { class: 'message-error', icon: 'fas fa-exclamation-triangle', iconColor: '#fde047' },
        'danger': { class: 'message-error', icon: 'fas fa-exclamation-triangle', iconColor: '#fde047' },
        'warning': { class: 'message-warning', icon: 'fas fa-exclamation-circle', iconColor: '#fde047' },
        'success': { class: 'message-success', icon: 'fas fa-check-circle', iconColor: '#d1fae5' },
        'info': { class: 'message-info', icon: 'fas fa-info-circle', iconColor: '#e0f2fe' }
    };
    
    const messageConfig = messageTypes[type] || messageTypes['info'];
    
    // Crear elemento del mensaje
    const messageElement = document.createElement('div');
    messageElement.className = `message-toast ${messageConfig.class}`;
    messageElement.setAttribute('data-auto-dismiss', 'true');
    
    messageElement.innerHTML = `
        <div class="message-header">
            <div class="message-content">
                <i class="${messageConfig.icon} message-icon" style="color: ${messageConfig.iconColor};"></i>
                <span class="message-text">${text}</span>
            </div>
            <button class="message-close" onclick="dismissMessage(this)">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="message-progress"></div>
    `;
    
    // Agregar al contenedor
    container.appendChild(messageElement);
    
    // Auto-dismiss después de 5 segundos
    setTimeout(function() {
        if (messageElement && messageElement.parentNode) {
            dismissMessage(messageElement.querySelector('.message-close'));
        }
    }, 5000);
    
    return messageElement;
}
</script>
{% endif %}
