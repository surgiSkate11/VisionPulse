{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard | VisionPulse{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-text-primary dark:text-dark-text-primary mb-1">Bienvenido, {{ user.first_name|default:user.username }}</h1>
        <p class="text-text-secondary dark:text-dark-text-secondary">Monitoreo y cuidado inteligente para tu salud visual.</p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
        <div class="metric-card dark:bg-dark-surface dark:border-dark-border-color">
            <div class="metric-header">
                <div class="metric-icon bg-accent-peach dark:bg-dark-accent-peach"><i class="fas fa-chart-line text-text-primary dark:text-dark-text-primary"></i></div>
                <p class="metric-title">Total de Sesiones</p>
            </div>
            <p class="metric-value">48</p>
            <p class="metric-trend text-accent-green dark:text-dark-accent-green"><i class="fas fa-arrow-up"></i> 12% vs semana pasada</p>
        </div>
        <div class="metric-card dark:bg-dark-surface dark:border-dark-border-color">
            <div class="metric-header">
                <div class="metric-icon bg-alert-amber"><i class="fas fa-clock"></i></div>
                <p class="metric-title">Tiempo Total de Uso</p>
            </div>
            <p class="metric-value">156h</p>
            <p class="metric-trend text-accent-green dark:text-dark-accent-green"><i class="fas fa-arrow-up"></i> 8% este mes</p>
        </div>
        <div class="metric-card dark:bg-dark-surface dark:border-dark-border-color">
            <div class="metric-header">
                <div class="metric-icon bg-alert-coral"><i class="fas fa-exclamation-triangle"></i></div>
                <p class="metric-title">Alertas Generadas</p>
            </div>
            <p class="metric-value">23</p>
            <p class="metric-trend text-accent-green dark:text-dark-accent-green"><i class="fas fa-arrow-up"></i> 5 esta semana</p>
        </div>
        <div class="metric-card dark:bg-dark-surface dark:border-dark-border-color">
            <div class="metric-header">
                <div class="metric-icon bg-accent-green dark:bg-dark-accent-green"><i class="fas fa-dumbbell"></i></div>
                <p class="metric-title">Ejercicios Completados</p>
            </div>
            <p class="metric-value">34</p>
            <p class="metric-trend text-accent-green dark:text-dark-accent-green"><i class="fas fa-arrow-up"></i> 15% vs semana pasada</p>
        </div>
        <div class="metric-card dark:bg-dark-surface dark:border-dark-border-color">
            <div class="metric-header">
                <div class="metric-icon bg-accent-peach dark:bg-dark-accent-peach"><i class="fas fa-coffee text-text-primary dark:text-dark-text-primary"></i></div>
                <p class="metric-title">Descansos Hoy</p>
            </div>
            <p class="metric-value">4/6</p>
            <div class="w-full bg-border-color rounded-full h-1.5 mt-2 dark:bg-dark-border-color"><div class="bg-accent-green dark:bg-dark-accent-green h-1.5 rounded-full" style="width: 67%"></div></div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 card p-6 dark:bg-dark-surface dark:border-dark-border-color">
            <h3 class="text-lg font-semibold text-text-primary dark:text-dark-text-primary">Monitor de Actividad Visual</h3>
            <p class="text-sm text-text-secondary dark:text-dark-text-secondary mb-4">Actividad de hoy</p>
            <div class="h-72"><canvas id="activityChart"></canvas></div>
        </div>
        <div class="card p-6 dark:bg-dark-surface dark:border-dark-border-color">
            <h3 class="text-lg font-semibold text-text-primary dark:text-dark-text-primary mb-4">Alertas Recientes</h3>
            <div class="space-y-3">
                <div class="alert-item hover:bg-background-primary dark:hover:bg-dark-background-primary">
                    <div class="alert-icon bg-alert-amber"><i class="fas fa-exclamation"></i></div>
                    <div>
                        <p class="text-sm font-medium text-text-primary dark:text-dark-text-primary">Fatiga visual detectada</p>
                        <p class="text-xs text-text-secondary dark:text-dark-text-secondary">hace 2 horas</p>
                    </div>
                </div>
                <div class="alert-item hover:bg-background-primary dark:hover:bg-dark-background-primary">
                    <div class="alert-icon bg-accent-peach text-text-primary dark:text-dark-text-primary"><i class="fas fa-arrow-down"></i></div>
                    <div>
                        <p class="text-sm font-medium text-text-primary dark:text-dark-text-primary">Nivel de parpadeo bajo</p>
                        <p class="text-xs text-text-secondary dark:text-dark-text-secondary">hace 4 horas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('activityChart')?.getContext('2d');
        if (ctx) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'],
                    datasets: [{
                        label: 'Parpadeos/min', data: [18, 16, 12, 15, 14, 10, 13, 11],
                        borderColor: '#A8B89F', backgroundColor: 'rgba(168, 184, 159, 0.1)',
                        tension: 0.4, borderWidth: 2.5, pointRadius: 4, pointBackgroundColor: '#A8B89F', fill: true
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#8C7E6A' } },
                        y: { grid: { color: 'rgba(140, 126, 106, 0.1)' }, ticks: { color: '#8C7E6A' } }
                    }
                }
            });
        }
    });
</script>
{% endblock %}